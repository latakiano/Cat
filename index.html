<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: Global Dungeon Legends</title>
    <style>
        :root { --neon: #ffd700; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Arial, sans-serif; touch-action: none; color: white; }
        
        /* Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© */
        #ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat-card { 
            background: rgba(20, 20, 30, 0.8); border: 2px solid var(--neon);
            backdrop-filter: blur(8px); padding: 12px 25px; border-radius: 30px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); font-weight: bold; font-size: 18px;
        }

        /* ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© */
        .overlay { 
            position: fixed; inset: 0; background: radial-gradient(circle at center, #1a0033 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; text-align: center; transition: 0.5s;
        }
        
        .btn {
            padding: 18px 60px; font-size: 24px; background: linear-gradient(45deg, #ffd700, #ff8c00);
            border: none; border-radius: 50px; color: #000; cursor: pointer; font-weight: bold;
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3); transition: 0.3s; margin: 10px;
        }
        .btn:hover { transform: scale(1.1); box-shadow: 0 15px 30px #ffd700; }
        .btn-shop { background: linear-gradient(45deg, #00f2ff, #0062ff); color: #fff; box-shadow: 0 10px 20px rgba(0, 242, 255, 0.3); }

        #shopUI { display: none; }
        .shop-box { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 25px; border: 1px solid var(--neon); margin: 20px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-card">üè∞ <span id="stageTitle">Loading...</span></div>
    <div class="stat-card">üí∞ <span id="coinScore">0</span></div>
</div>

<div id="startScreen" class="overlay">
    <h1 id="mainTitle" style="font-size: 3rem; text-shadow: 0 0 30px #ffd700;">HIMALAYAN LEGENDS</h1>
    <p id="subTitle" style="color: #ccc; font-size: 1.2rem;">Conquer 20 Global Dungeons</p>
    <button class="btn" onclick="startGame()" id="playBtn">START MISSION</button>
    <button class="btn btn-shop" onclick="toggleShop(true)" id="shopBtn">ARMORY (0.30$)</button>
</div>

<div id="shopUI" class="overlay">
    <h1 id="shopTitle">UPGRADES</h1>
    <div class="shop-box">
        <h3>ULTIMATE CAT PAW</h3>
        <p>Double Jump & Higher Speed</p>
        <div style="font-size: 24px; color: #ffd700; margin: 15px;">0.30 $</div>
        <button class="btn" onclick="buyItem()">PURCHASE</button>
    </div>
    <button class="btn" style="background: #333; color: #fff;" onclick="toggleShop(false)">BACK</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    let audioCtx;

    // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸàÿßŸÑŸÑÿ∫ÿßÿ™ ---
    const isAr = navigator.language.startsWith('ar');
    const lang = {
        ar: { start: "ÿ®ÿØÿ° ÿßŸÑŸÖŸáŸÖÿ©", shop: "ÿßŸÑŸÖÿ™ÿ¨ÿ± (0.30$)", shopT: "ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿ™ÿ∑ŸàŸäÿ±ÿßÿ™", dungeon: "ÿØŸáŸÑŸäÿ≤", death: "ÿ≥ÿ≠ŸÇÿ™ŸÉ ÿßŸÑŸàÿ≠Ÿàÿ¥!", win: "ÿ£ÿ≥ÿ∑Ÿàÿ±ÿ© ÿßŸÑŸÑÿßÿ∞ŸÇŸäÿ©!" },
        en: { start: "START MISSION", shop: "ARMORY (0.30$)", shopT: "UPGRADES", dungeon: "Dungeon of", death: "GAME OVER!", win: "LATAKIA LEGEND!" }
    }[isAr ? 'ar' : 'en'];

    document.getElementById('playBtn').innerText = lang.start;
    document.getElementById('shopBtn').innerText = lang.shop;
    document.getElementById('shopTitle').innerText = lang.shopT;

    // --- ŸÖÿ≠ÿ±ŸÉ ÿßŸÑÿµŸàÿ™ ---
    function playSound(freq, type = 'sine', duration = 0.1) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    // --- ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑŸÄ 20 ŸÖÿ±ÿ≠ŸÑÿ© ---
    const cities = ["London", "New York", "Paris", "Berlin", "Amsterdam", "Beijing", "Rome", "Moscow", "Athens", "Bucharest", "Tokyo", "Dubai", "Cairo", "Madrid", "Sydney", "Rio", "Seoul", "Istanbul", "Prague", "Latakia"];
    const colors = ["#FFFF00", "#0000FF", "#FF0000", "#00FF00", "#FFFFFF", "#00FFFF", "#8B4513", "#800000", "#800080", "#000080", "#FF4500", "#FFD700", "#C0C0C0", "#32CD32", "#1E90FF", "#FF69B4", "#00CED1", "#A52A2A", "#556B2F", "#00f2ff"];
    
    const STAGES = cities.map((city, i) => ({
        name: `${isAr ? 'ÿØŸáŸÑŸäÿ≤' : 'Dungeon of'} ${city}`,
        color: colors[i],
        monster: i === 19 ? 'lion' : ['wolf', 'ghost', 'dragon'][i % 3],
        speed: 6.5 + (i * 0.4)
    }));

    // ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ (ÿ£ŸäŸÇŸàŸÜÿßÿ™ ÿ¥ŸÅÿßŸÅÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©)
    const assets = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        coin: 'https://img.icons8.com/color/48/gold-pot.png',
        wolf: 'https://img.icons8.com/fluency/150/werewolf.png',
        ghost: 'https://img.icons8.com/fluency/150/ghost.png',
        dragon: 'https://img.icons8.com/fluency/150/dragon.png',
        lion: 'https://img.icons8.com/fluency/150/lion.png'
    };
    const img = {}; Object.keys(assets).forEach(k => { img[k] = new Image(); img[k].src = assets[k]; });

    let cur = 0, score = 0, active = false, started = false;
    let p = { x: 130, y: 0, v: 0 }, m = { x: -300, y: 0 };
    let obstacles = [], coins = [], stageDist = 2000;

    function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        p.y = canvas.height / 2; p.v = 0; m.x = -300;
        obstacles = []; coins = []; stageDist = 2000; active = true; started = false;
        document.getElementById('stageTitle').innerText = STAGES[cur].name;
    }

    function toggleShop(show) { document.getElementById('shopUI').style.display = show ? 'flex' : 'none'; }
    function buyItem() { alert("Redirecting to Secure Payment (0.30$)..."); }

    function gameLoop() {
        let s = STAGES[cur];
        ctx.fillStyle = "#050508"; ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (active && started) {
            p.v += 0.55; p.y += p.v; 
            m.y += (p.y - m.y) * 0.05; m.x = Math.min(p.x - 150, m.x + 0.35);
            stageDist -= s.speed/2;

            if (stageDist <= 0 && cur < 19) { 
                cur++; stageDist = 2000; 
                document.getElementById('stageTitle').innerText = STAGES[cur].name;
                playSound(600, 'sine', 0.3); 
            }

            // ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ£ÿπŸÖÿØÿ© (ŸÖÿ™ÿ®ÿßÿπÿØÿ©)
            if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 550) {
                obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-400)+100, h: 280 });
            }

            // ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ¨Ÿàÿßÿ¶ÿ≤ (ŸÖÿ™Ÿàÿßÿ≤ŸÜÿ©)
            if (Math.random() < 0.008) coins.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50 });

            obstacles.forEach((o, i) => {
                o.x -= s.speed;
                ctx.fillStyle = s.color; ctx.globalAlpha = 0.5;
                ctx.fillRect(o.x, 0, 55, o.y); ctx.fillRect(o.x, o.y+o.h, 55, canvas.height);
                ctx.globalAlpha = 1;
                
                // ŸÉÿ™ÿßÿ®ÿ© ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿπŸÑŸâ ÿßŸÑÿπŸÖŸàÿØ ÿ®ÿ¨ŸÖÿßŸÑŸäÿ©
                ctx.fillStyle = "white"; ctx.font = "bold 12px sans-serif";
                ctx.fillText(cities[cur].toUpperCase(), o.x + 5, o.y - 10);

                if (p.x + 40 > o.x && p.x < o.x + 55 && (p.y < o.y || p.y + 45 > o.y + o.h)) die();
                if (o.x < -100) obstacles.splice(i, 1);
            });

            coins.forEach((c, i) => {
                c.x -= s.speed;
                ctx.drawImage(img.coin, c.x, c.y, 40, 40);
                if (Math.hypot(p.x - c.x, p.y - c.y) < 50) { 
                    score += 10; coins.splice(i, 1); 
                    playSound(880); // ÿµŸàÿ™ ŸÇÿ∑ŸÅ ÿßŸÑÿ¨ÿßÿ¶ÿ≤ÿ©
                }
            });

            if (p.y > canvas.height || p.y < -100 || p.x < m.x + 80) die();
            document.getElementById('coinScore').innerText = score;
        }

        // --- ÿ±ÿ≥ŸÖ ÿßŸÑŸàÿ≠ÿ¥ (ŸäŸàÿßÿ¨Ÿá ÿßŸÑŸÇÿ∑ÿ©ÿå ÿ™ŸÜŸÅÿ≥ 3Dÿå ÿ®ÿØŸàŸÜ ÿØÿßÿ¶ÿ±ÿ©) ---
        let breath = Math.sin(Date.now() / 200) * 10;
        ctx.save();
        ctx.translate(m.x + 160, m.y + breath); 
        ctx.scale(-1, 1); // ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÑŸÑŸÇÿ∑ÿ©
        ctx.shadowBlur = 20; ctx.shadowColor = s.color;
        ctx.drawImage(img[s.monster], 0, 0, 160 + breath, 160 - breath);
        ctx.restore();

        // ÿ±ÿ≥ŸÖ ÿßŸÑŸÇÿ∑ÿ©
        ctx.drawImage(img.cat, p.x, p.y, 85, 85);

        requestAnimationFrame(gameLoop);
    }

    function die() {
        active = false; playSound(100, 'sawtooth', 0.4);
        document.getElementById('startScreen').style.display = 'flex';
        document.getElementById('mainTitle').innerText = lang.death;
        document.getElementById('playBtn').innerText = isAr ? "ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©" : "RETRY";
    }

    const jump = () => { if (active) { started = true; p.v = -9.5; playSound(400); } }
    window.onmousedown = jump; window.ontouchstart = (e) => { e.preventDefault(); jump(); };
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
    gameLoop();
</script>
</body>
</html>