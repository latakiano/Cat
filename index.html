<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Legends: Pro Edition</title>
    <style>
        :root { --gold: #ffd700; --neon: #00f2ff; --diamond: #b9f2ff; }
        body { margin: 0; overflow: hidden; background: #050508; font-family: 'Arial', sans-serif; touch-action: none; color: white; }
        #ui { position: absolute; top: 10px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 100; pointer-events: none; }
        .stats-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .stat-box { background: rgba(0,0,0,0.9); border: 2px solid var(--gold); padding: 5px 12px; border-radius: 10px; font-weight: bold; font-size: 13px; }
        #progress-container { width: 85%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; border: 1px solid #444; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--neon), #0066ff); }
        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; padding: 15px; }
        .btn { padding: 15px 30px; font-size: 18px; background: var(--gold); border: none; border-radius: 50px; color: #000; cursor: pointer; font-weight: bold; margin: 8px; box-shadow: 0 5px 15px rgba(255,215,0,0.4); }
        .shop-panel { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--neon); }
        .leaderboard { font-size: 12px; color: var(--gold); margin-top: 10px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stats-row">
        <div class="stat-box">ğŸŒ <span id="city-name">LONDON</span></div>
        <div class="stat-box">ğŸ’° <span id="gold-val">0</span></div>
        <div class="stat-box">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨: <span id="rank">#21</span></div>
    </div>
    <div id="progress-container"><div id="progress-bar"></div></div>
</div>

<div id="startScreen" class="screen">
    <h2 style="color: var(--gold); margin: 0;">Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ù‚Ø·Ø·</h2>
    <div class="leaderboard" id="leaderboard">Ø£ÙˆÙ„ 20 Ø¨Ø·Ù„ ÙŠØªØ£Ù‡Ù„ÙˆÙ† Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©!</div>
    
    <div class="shop-panel">
        <p style="margin:5px; font-size:14px;">ØªØ·ÙˆÙŠØ±Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨:</p>
        <button class="btn" style="font-size:14px; padding:10px 20px; background:var(--neon);" onclick="buyFeature()">Ø´Ø±Ø§Ø¡ Ù‚Ø·Ø© Ø£Ø³Ø·ÙˆØ±ÙŠØ© (5.99$)</button>
    </div>

    <button class="btn" onclick="game.start()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
const STAGES = ["London", "New York", "Paris", "Berlin", "Tokyo", "Dubai", "Latakia"];
const COLORS = ["#FF3131", "#39FF14", "#00FFFF", "#FFFF33", "#FF00FF", "#FFAC1C", "#00f2ff"];

let audioCtx;
function playSound(freq, type, dur) {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

let game = {
    active: false, gold: 0, curStage: 0, progress: 0, target: 1500,
    init() { this.resize(); window.onresize = () => this.resize(); this.loop(); },
    resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; },
    start() { document.getElementById('startScreen').style.display = 'none'; p.y = canvas.height/2; p.v = 0; this.progress = 0; obstacles = []; items = []; this.active = true; },
    loop() { update(); draw(); requestAnimationFrame(() => game.loop()); }
};

let p = { x: 90, y: 0, v: 0, g: 0.55, jump: -10 };
let enemy = { x: -150, y: 0 };
let obstacles = [], items = [];

function drawCat(x, y) {
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = "white";
    ctx.beginPath(); ctx.ellipse(30, 25, 22, 16, 0, 0, Math.PI*2); ctx.fill(); // Ø§Ù„Ø¬Ø³Ù…
    ctx.fillRect(15, 38, 6, 10); ctx.fillRect(40, 38, 6, 10); // Ø£Ø±Ø¬Ù„
    ctx.beginPath(); ctx.arc(50, 15, 12, 0, Math.PI*2); ctx.fill(); // Ø±Ø£Ø³
    ctx.fillStyle = "#5D4037"; ctx.beginPath(); ctx.moveTo(45, 5); ctx.lineTo(40, -5); ctx.lineTo(50, 3); ctx.fill(); // Ø£Ø°Ù†
    ctx.fillStyle = "blue"; ctx.beginPath(); ctx.arc(55, 13, 2, 0, Math.PI*2); ctx.fill(); // Ø¹ÙŠÙ†
    ctx.restore();
}

function drawMonster(x, y) {
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = COLORS[game.curStage];
    ctx.beginPath(); ctx.moveTo(0, 0); ctx.quadraticCurveTo(110, -30, 130, 40); // Ø§Ù„ÙÙƒ Ø§Ù„Ø¹Ù„ÙˆÙŠ
    ctx.lineTo(130, 55); ctx.quadraticCurveTo(110, 110, 0, 80); ctx.fill(); // Ø§Ù„ÙÙƒ Ø§Ù„Ø³ÙÙ„ÙŠ
    ctx.fillStyle = "white"; // Ø§Ù„Ø£Ø³Ù†Ø§Ù†
    for(let i=0; i<5; i++) { ctx.beginPath(); ctx.moveTo(95+(i*7), 40); ctx.lineTo(98+(i*7), 52); ctx.lineTo(102+(i*7), 40); ctx.fill(); }
    ctx.fillStyle = "red"; ctx.beginPath(); ctx.arc(85, 25, 6, 0, Math.PI*2); ctx.fill(); // Ø¹ÙŠÙ†
    ctx.restore();
}

function update() {
    if(!game.active) return;
    p.v += p.g; p.y += p.v;
    enemy.y += (p.y - enemy.y) * 0.05;
    enemy.x = Math.min(p.x - 110, enemy.x + (0.4 + game.curStage*0.12));
    game.progress += 2.5;
    document.getElementById('progress-bar').style.width = (game.progress/game.target*100) + "%";

    if(game.progress >= game.target) {
        game.active = false; game.curStage = (game.curStage + 1) % STAGES.length;
        document.getElementById('startScreen').style.display = 'flex';
        if(game.gold > 100) document.getElementById('rank').innerText = "#" + Math.max(1, 21 - Math.floor(game.gold/100));
    }

    if(obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 450) {
        obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-300)+50, h: 250 });
    }
    obstacles.forEach((o, i) => {
        o.x -= (7 + game.curStage);
        if(p.x+50 > o.x && p.x < o.x+50 && (p.y < o.y || p.y+45 > o.y+o.h)) { game.active = false; document.getElementById('startScreen').style.display = 'flex'; }
    });

    if(Math.random() < 0.02) items.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50, type: Math.random() > 0.1 ? 'coin' : 'diamond' });
    items.forEach((c, i) => {
        c.x -= (7 + game.curStage);
        if(Math.hypot(p.x+30 - c.x, p.y+20 - c.y) < 35) {
            if(c.type === 'coin') { game.gold += 10; playSound(800, 'square', 0.1); }
            else { game.gold += 50; playSound(1200, 'sine', 0.2); } // ØµÙˆØª Ø§Ù„Ù…Ø§Ø³
            items.splice(i, 1);
        }
    });

    if(p.y > canvas.height || p.y < -50 || p.x < enemy.x + 80) { game.active = false; document.getElementById('startScreen').style.display = 'flex'; }
    document.getElementById('gold-val').innerText = game.gold;
    document.getElementById('city-name').innerText = STAGES[game.curStage].toUpperCase();
}

function draw() {
    ctx.fillStyle = "#050508"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    obstacles.forEach(o => {
        ctx.fillStyle = COLORS[game.curStage]; ctx.shadowBlur = 15; ctx.shadowColor = COLORS[game.curStage];
        ctx.fillRect(o.x, 0, 50, o.y); ctx.fillRect(o.x, o.y+o.h, 50, canvas.height); ctx.shadowBlur = 0;
    });
    items.forEach(c => {
        ctx.fillStyle = c.type === 'coin' ? "gold" : "#b9f2ff";
        ctx.beginPath(); ctx.arc(c.x, c.y, c.type === 'coin' ? 10 : 14, 0, Math.PI*2); ctx.fill();
    });
    drawMonster(enemy.x, enemy.y); drawCat(p.x, p.y);
}

function buyFeature() {
    alert("Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹ Ø­Ø³Ø¨ Ø¨Ù„Ø¯Ùƒ... Ø§Ù„Ø³Ø¹Ø±: 5.99$\nØ§Ù„Ù…Ù…ÙŠØ²Ø§Øª: Ù‚ÙØ²Ø© Ù…Ø¶Ø§Ø¹ÙØ© + Ø¯Ø±Ø¹ Ø¶Ø¯ Ø§Ù„ÙˆØ­ÙˆØ´!");
}

window.onmousedown = () => { if(game.active) { p.v = p.jump; playSound(150, 'triangle', 0.15); } };
window.ontouchstart = (e) => { e.preventDefault(); if(game.active) { p.v = p.jump; playSound(150, 'triangle', 0.15); } };
game.init();
</script>
</body>
</html>