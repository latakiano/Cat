<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat Adventure</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #top-ui { position: absolute; top: 0; width: 100%; height: 50px; display: flex; justify-content: space-around; align-items: center; color: gold; background: rgba(0,0,0,0.7); z-index: 10; border-bottom: 2px solid gold; }
        #speedo { position: absolute; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; border: 2px solid cyan; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; background: rgba(0,0,0,0.8); z-index: 10; }
        #overlay { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: gold; }
        .btn { padding: 15px 40px; font-size: 22px; background: gold; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="top-ui">
    <div id="city-disp">LONDON</div>
    <div>GOLD: <span id="gold-disp">0</span></div>
</div>

<div id="speedo">
    <b id="km-disp">0</b><small>KM/H</small>
</div>

<div id="overlay">
    <h2>أساطير الهيمالايا 2026</h2>
    <p style="color:#ccc">القطة ذات الأذنين البنيتين</p>
    <button class="btn" id="startBtn">دخول الكهف</button>
</div>

<canvas id="c"></canvas>

<script>
const cvs = document.getElementById('c'), ctx = cvs.getContext('2d');
let active = false, stage = 0, dist = 0, gold = 0;
const STAGES = [{n:"LONDON", c:"red"}, {n:"PARIS", c:"#39FF14"}, {n:"ROME", c:"cyan"}, {n:"LATAKIA", c:"gold"}];

let p = { x: 80, y: 0, v: 0, g: 0.6, j: -10 };
let boss = { x: -300, y: 0 };
let obs = [], portal = null;

function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
window.onresize = resize; resize();

document.getElementById('startBtn').onclick = () => {
    p.y = cvs.height/2; p.v = 0; boss.x = -300; obs = []; dist = 0; portal = null;
    document.getElementById('overlay').style.display = 'none';
    active = true;
};

window.onmousedown = () => { if(active) p.v = p.j; };
window.ontouchstart = (e) => { if(active) { p.v = p.j; e.preventDefault(); } };

function drawCat(x, y) {
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.ellipse(25, 20, 22, 16, 0, 0, Math.PI*2); ctx.fill(); // الجسم
    ctx.beginPath(); ctx.arc(45, 12, 13, 0, Math.PI*2); ctx.fill(); // الرأس
    ctx.fillStyle = "#4e342e"; // الأذنين البنيتين
    ctx.beginPath(); ctx.moveTo(35, 5); ctx.lineTo(32, -10); ctx.lineTo(42, 2); ctx.fill();
    ctx.beginPath(); ctx.moveTo(52, 5); ctx.lineTo(55, -10); ctx.lineTo(48, 2); ctx.fill();
    ctx.fillStyle = "cyan"; ctx.beginPath(); ctx.arc(50, 10, 3, 0, Math.PI*2); ctx.fill(); // عين
    ctx.fillStyle = "white"; ctx.fillRect(10, 32, 6, 12); ctx.fillRect(40, 32, 6, 12); // أرجل
    ctx.restore();
}

function update() {
    if(!active) return;
    p.v += p.g; p.y += p.v;
    boss.y += (p.y - boss.y) * 0.05;
    boss.x = Math.min(p.x - 100, boss.x + (0.8 + stage*0.2));
    dist += 5;
    document.getElementById('km-disp').innerText = Math.floor(10 + dist/50);
    
    if(dist > 2000 && !portal) portal = { x: cvs.width, y: cvs.height/2 - 100 };
    if(portal) {
        portal.x -= 7;
        if(p.x > portal.x + 50) { active = false; stage = (stage+1)%STAGES.length; document.getElementById('overlay').style.display = 'flex'; }
    } else if(obs.length === 0 || obs[obs.length-1].x < cvs.width - 400) {
        obs.push({ x: cvs.width, y: Math.random()*(cvs.height-300)+100, h: 250 });
    }

    obs.forEach((o, i) => {
        o.x -= (7 + stage);
        if(p.x+40 > o.x && p.x < o.x+50 && (p.y < o.y || p.y+35 > o.y+o.h)) { active = false; document.getElementById('overlay').style.display = 'flex'; }
        if(o.x < -100) obs.splice(i, 1);
    });

    if(p.y > cvs.height || p.y < -50 || p.x < boss.x + 80) { active = false; document.getElementById('overlay').style.display = 'flex'; }
    document.getElementById('city-disp').innerText = STAGES[stage].n;
}

function draw() {
    ctx.fillStyle = "#050508"; ctx.fillRect(0, 0, cvs.width, cvs.height);
    if(portal) {
        ctx.fillStyle = STAGES[stage].c; ctx.beginPath(); ctx.arc(portal.x+100, portal.y+100, 100, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#000"; ctx.beginPath(); ctx.arc(portal.x+100, portal.y+100, 80, 0, Math.PI*2); ctx.fill();
    }
    obs.forEach(o => {
        ctx.fillStyle = STAGES[stage].c; ctx.fillRect(o.x, 0, 50, o.y); ctx.fillRect(o.x, o.y+o.h, 50, cvs.height);
    });
    ctx.fillStyle = STAGES[stage].c; ctx.beginPath(); ctx.moveTo(boss.x, boss.y); ctx.lineTo(boss.x+130, boss.y+20); ctx.lineTo(boss.x+90, boss.y+40); ctx.lineTo(boss.x+130, boss.y+60); ctx.lineTo(boss.x, boss.y+80); ctx.fill();
    drawCat(p.x, p.y);
    update();
    requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>