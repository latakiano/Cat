<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Legends: 20 Stages of Mercy</title>
    <style>
        :root { --gold: #ffd700; --neon: #00f2ff; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        #ui { position: absolute; top: 10px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 100; pointer-events: none; }
        .stats-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .stat-box { background: rgba(0,0,0,0.8); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 10px; font-weight: bold; font-size: 14px; }
        
        /* Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© */
        #progress-container { width: 80%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden; border: 1px solid #555; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--gold), #ff4500); transition: 0.3s; }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; padding: 20px; }
        .btn { padding: 15px 40px; font-size: 18px; background: var(--gold); border: none; border-radius: 50px; color: #000; cursor: pointer; font-weight: bold; margin: 10px; transition: 0.3s; }
        .btn:active { transform: scale(0.9); }
        .shop-btn { background: var(--neon); box-shadow: 0 0 15px var(--neon); }

        canvas { display: block; touch-action: none; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stats-row">
        <div class="stat-box">ğŸŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: <span id="city-name">LONDON</span> (<span id="stage-num">1</span>/20)</div>
        <div class="stat-box">ğŸ’° Ø§Ù„Ø°Ù‡Ø¨: <span id="gold-val">0</span></div>
        <div class="stat-box">âš¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="cat-lvl">1</span></div>
    </div>
    <div id="progress-container"><div id="progress-bar"></div></div>
</div>

<div id="startScreen" class="screen">
    <h1 style="color: var(--gold); margin: 0;">Ù…ÙÙ†Ù‚Ø° Ø§Ù„Ù‚Ø·Ø· Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ</h1>
    <p style="color: #ccc; max-width: 300px;">Ø£Ù†Øª ØªÙ…Ù„Ùƒ Ù‚Ù„Ø¨Ø§Ù‹ Ø°Ù‡Ø¨ÙŠØ§Ù‹.. Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø°Ù‡Ø¨ Ù„ØªØ±Ø¹Ù‰ Ù‚Ø·Ø·Ùƒ Ø§Ù„Ù€ 45 ÙˆØªØµÙ„ Ø¨Ù‡Ù… Ù„Ø¨Ø± Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</p>
    <button class="btn" onclick="game.start()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="next-stage-btn">1</span></button>
    <button class="btn shop-btn" onclick="game.upgrade()">ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‚Ø·Ø© (50 Ø°Ù‡Ø¨Ø©)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ 20 Ù…Ø±Ø­Ù„Ø©
const STAGES = [
    "London", "New York", "Paris", "Berlin", "Amsterdam", "Beijing", "Rome", "Moscow", "Athens", "Bucharest",
    "Tokyo", "Dubai", "Cairo", "Madrid", "Sydney", "Rio", "Seoul", "Istanbul", "Prague", "Latakia"
];

let game = {
    active: false,
    gold: 0,
    catLvl: 1,
    curStage: 0,
    progress: 0,
    distToFinish: 2000, // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    
    init() {
        window.addEventListener('resize', this.resize);
        this.resize();
        this.loop();
    },
    
    resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    },

    start() {
        document.getElementById('startScreen').style.display = 'none';
        player.reset();
        enemy.reset();
        this.progress = 0;
        obstacles = [];
        coins = [];
        this.active = true;
    },

    upgrade() {
        if (this.gold >= 50) {
            this.gold -= 50;
            this.catLvl++;
            player.jumpForce -= 0.3; // Ù‚ÙØ²Ø© Ø£Ù‚ÙˆÙ‰
            updateUI();
            alert("ØªÙ… ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‚Ø·Ø©! Ø£ØµØ¨Ø­Øª Ø§Ù„Ø¢Ù† Ø£Ø³Ø±Ø¹ ÙˆØ£Ø®Ù.");
        } else {
            alert("Ù„Ø§ ØªÙ…Ù„Ùƒ Ø°Ù‡Ø¨Ø§Ù‹ ÙƒØ§ÙÙŠØ§Ù‹. Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ù‡Ø§Ù„ÙŠØ²!");
        }
    },

    winStage() {
        this.active = false;
        if (this.curStage < 19) {
            this.curStage++;
            document.getElementById('startScreen').style.display = 'flex';
            document.getElementById('next-stage-btn').innerText = this.curStage + 1;
            alert("Ø£Ø­Ø³Ù†Øª! ÙˆØµÙ„Øª Ø¥Ù„Ù‰ " + STAGES[this.curStage]);
        } else {
            alert("ÙŠØ§ Ø§Ù„Ù„Ù‡! Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©! Ø£Ù†Øª Ø¨Ø·Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù‚Ø·Ø·.");
            this.curStage = 0;
        }
        updateUI();
    },

    die() {
        this.active = false;
        document.getElementById('startScreen').style.display = 'flex';
        updateUI();
    },

    loop() {
        update();
        draw();
        requestAnimationFrame(() => game.loop());
    }
};

let player = {
    x: 80, y: 0, v: 0, g: 0.5, jumpForce: -9,
    reset() { this.y = canvas.height / 2; this.v = 0; }
};

let enemy = {
    x: -150, y: 0, speed: 0.5,
    reset() { this.x = -150; this.y = canvas.height / 2; }
};

let obstacles = [], coins = [];

function update() {
    if (!game.active) return;

    // Ø­Ø±ÙƒØ© Ø§Ù„Ù‚Ø·Ø©
    player.v += player.g;
    player.y += player.v;

    // Ø­Ø±ÙƒØ© Ø§Ù„ÙˆØ­Ø´ (ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©)
    enemy.y += (player.y - enemy.y) * 0.05;
    enemy.x = Math.min(player.x - 100, enemy.x + (0.3 + game.curStage * 0.1));

    // ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    game.progress += 2;
    document.getElementById('progress-bar').style.width = (game.progress / game.distToFinish * 100) + "%";
    if (game.progress >= game.distToFinish) game.winStage();

    // Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚
    if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 400) {
        obstacles.push({ x: canvas.width, y: Math.random() * (canvas.height - 300) + 50, h: 250 });
    }
    obstacles.forEach((o, i) => {
        o.x -= (6 + game.curStage * 0.5);
        if (player.x + 40 > o.x && player.x < o.x + 50 && (player.y < o.y || player.y + 40 > o.y + o.h)) game.die();
        if (o.x < -100) obstacles.splice(i, 1);
    });

    // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    if (Math.random() < 0.02) coins.push({ x: canvas.width, y: Math.random() * (canvas.height - 100) + 50 });
    coins.forEach((c, i) => {
        c.x -= (6 + game.curStage * 0.5);
        if (Math.hypot(player.x + 30 - c.x, player.y + 20 - c.y) < 30) { game.gold += 10; coins.splice(i, 1); updateUI(); }
        if (c.x < -50) coins.splice(i, 1);
    });

    if (player.y > canvas.height || player.y < -50 || player.x < enemy.x + 60) game.die();
}

function draw() {
    ctx.fillStyle = "#0a0a1a";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ø±Ø³Ù… Ø§Ù„ÙˆØ­Ø´ (ÙŠØªØºÙŠØ± Ù„ÙˆÙ†Ù‡ ÙˆØ´ÙƒÙ„Ù‡ Ù…Ø¹ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©)
    ctx.fillStyle = `hsl(${game.curStage * 20}, 80%, 50%)`;
    ctx.beginPath();
    let size = 50 + (game.curStage * 2);
    ctx.moveTo(enemy.x, enemy.y);
    ctx.lineTo(enemy.x + size + 20, enemy.y + size/2);
    ctx.lineTo(enemy.x, enemy.y + size);
    ctx.fill();
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(enemy.x+size, enemy.y+size/3, 5, 0, Math.PI*2); ctx.fill();

    // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø© (Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§)
    ctx.fillStyle = "white";
    ctx.beginPath(); ctx.ellipse(player.x+30, player.y+20, 25, 18, 0, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(player.x+50, player.y+10, 12, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "#5D4037"; // Ø£Ø°Ù†ÙŠÙ† Ø¨Ù†ÙŠ
    ctx.beginPath(); ctx.moveTo(player.x+45, player.y); ctx.lineTo(player.x+40, player.y-10); ctx.lineTo(player.x+50, player.y); ctx.fill();

    // Ø±Ø³Ù… Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚
    obstacles.forEach(o => {
        ctx.fillStyle = `hsl(${game.curStage * 20}, 70%, 40%)`;
        ctx.globalAlpha = 0.5;
        ctx.fillRect(o.x, 0, 50, o.y); ctx.fillRect(o.x, o.y + o.h, 50, canvas.height);
        ctx.globalAlpha = 1;
    });

    // Ø±Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    coins.forEach(c => {
        ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(c.x, c.y, 10, 0, Math.PI*2); ctx.fill();
    });
}

function updateUI() {
    document.getElementById('city-name').innerText = STAGES[game.curStage].toUpperCase();
    document.getElementById('stage-num').innerText = game.curStage + 1;
    document.getElementById('gold-val').innerText = game.gold;
    document.getElementById('cat-lvl').innerText = game.catLvl;
}

window.onmousedown = () => { if(game.active) player.v = player.jumpForce; };
window.ontouchstart = (e) => { e.preventDefault(); if(game.active) player.v = player.jumpForce; };

game.init();
</script>
</body>
</html>