<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: Global Journey</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; touch-action: none; }
        #ui { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat-item { background: rgba(0, 0, 0, 0.7); border: 2px solid #fff; padding: 10px 20px; border-radius: 15px; color: #fff; font-weight: bold; box-shadow: 0 0 15px rgba(255,255,255,0.2); font-size: 20px; }
        #overlay { position: fixed; inset: 0; background: radial-gradient(circle, #111 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: #fff; text-align: center; }
        .btn { padding: 15px 50px; font-size: 25px; background: linear-gradient(45deg, #ffd700, #ff8c00); color: #000; border: none; cursor: pointer; border-radius: 50px; font-weight: bold; box-shadow: 0 0 20px #ffd700; transition: 0.3s; margin-top: 20px; }
        .btn:hover { transform: scale(1.1); }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-item">üåç <span id="cityName">LONDON</span></div>
    <div class="stat-item">üí∞ <span id="coinText">0</span></div>
</div>

<div id="overlay">
    <h1 id="mainMsg" style="font-size: 50px; text-shadow: 0 0 20px #ffd700;">HIMALAYAN WORLD TOUR</h1>
    <p id="subMsg" style="font-size: 20px; color: #aaa;">Collect coins and reach LATAKIA!</p>
    <button class="btn" onclick="initGame()">START JOURNEY üöÄ</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    let audioCtx;

    // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ∑Ÿàÿ± ---
    function playSound(type) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        
        if (type === 'jump') {
            osc.type = 'triangle'; osc.frequency.setValueAtTime(450, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        } else if (type === 'coin') {
            osc.type = 'sine'; osc.frequency.setValueAtTime(900, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        } else if (type === 'die') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        }

        osc.connect(gain).connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.15);
    }

    // --- ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ (20 ŸÖÿ±ÿ≠ŸÑÿ©) ---
    const STAGES = [
        { name: "LONDON", col: "#FFFF00" },      // 1 ÿµŸÅÿ±ÿßÿ°
        { name: "NEW YORK", col: "#0000FF" },    // 2 ÿ≤ÿ±ŸÇÿßÿ°
        { name: "PARIS", col: "#FF0000" },       // 3 ÿ≠ŸÖÿ±ÿßÿ°
        { name: "BERLIN", col: "#00FF00" },      // 4 ÿÆÿ∂ÿ±ÿßÿ°
        { name: "AMSTERDAM", col: "#FFFFFF" },   // 5 ÿ®Ÿäÿ∂ÿßÿ° (ÿ´ŸÑÿ¨Ÿäÿ©)
        { name: "BEIJING", col: "#4da6ff" },     // 6 ÿ≤ÿ±ŸÇÿßÿ° ŸÅÿßÿ™ÿ≠ÿ©
        { name: "ROME", col: "#8B4513" },        // 7 ÿ®ŸÜŸä
        { name: "MOSCOW", col: "#800000" },      // 8 ÿÆŸÖÿ±Ÿä
        { name: "ATHENS", col: "#800080" },      // 9 ŸÖŸàŸÅ
        { name: "BUCHAREST", col: "#000080" },   // 10 ŸÉÿ≠ŸÑŸä
        { name: "TOKYO", col: "#FF4500" },
        { name: "DUBAI", col: "#FFD700" },
        { name: "CAIRO", col: "#C0C0C0" },
        { name: "MADRID", col: "#32CD32" },
        { name: "SYDNEY", col: "#1E90FF" },
        { name: "RIO", col: "#FF69B4" },
        { name: "SEOUL", col: "#00CED1" },
        { name: "ISTANBUL", col: "#A52A2A" },
        { name: "PRAGUE", col: "#556B2F" },
        { name: "LATAKIA", col: "#00f2ff" }      // ÿßŸÑÿ£ÿÆŸäÿ±ÿ©
    ];

    const assets = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        wolf: 'https://img.icons8.com/fluency/150/werewolf.png', // ÿµŸàÿ± ÿ¥ŸÅÿßŸÅÿ© ÿ®ÿØŸàŸÜ ÿØŸàÿßÿ¶ÿ±
        ghost: 'https://img.icons8.com/fluency/150/ghost.png',
        lion: 'https://img.icons8.com/fluency/150/lion.png',
        dragon: 'https://img.icons8.com/fluency/150/dragon.png'
    };
    const imgObj = {}; Object.keys(assets).forEach(k => { imgObj[k] = new Image(); imgObj[k].src = assets[k]; });

    let curStage = 0, score = 0, active = false, started = false;
    let p = { x: 130, y: 0, v: 0 }, m = { x: -300, y: 0 };
    let obstacles = [], coins = [], distanceToNext = 1500;

    function initGame() {
        document.getElementById('overlay').style.display = 'none';
        p.y = canvas.height / 2; p.v = 0; m.x = -300;
        obstacles = []; coins = []; active = true; started = false; distanceToNext = 1500;
        document.getElementById('cityName').innerText = STAGES[curStage].name;
    }

    function gameLoop() {
        let s = STAGES[curStage];
        ctx.fillStyle = "#050505"; ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (active && started) {
            p.v += 0.52; p.y += p.v; 
            m.y += (p.y - m.y) * 0.05; m.x = Math.min(p.x - 150, m.x + 0.35);
            distanceToNext -= 1;

            if (distanceToNext <= 0 && curStage < 19) {
                curStage++; distanceToNext = 1500;
                document.getElementById('cityName').innerText = STAGES[curStage].name;
            }

            // ÿ™ŸàŸÑŸäÿØ ÿπŸàÿßÿ¶ŸÇ (ÿ£ÿπŸÖÿØÿ© ŸÖÿ™ÿ®ÿßÿπÿØÿ©)
            if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 500) {
                if (Math.random() < 0.02) {
                    obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-400)+100, h: 280 });
                }
            }

            // ÿ™ŸàŸÑŸäÿØ ÿπŸÖŸÑÿßÿ™ (ŸÇŸÑŸäŸÑÿ© ŸàŸÖÿ™Ÿàÿßÿ≤ŸÜÿ©)
            if (Math.random() < 0.005) {
                coins.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50 });
            }

            obstacles.forEach((o, i) => {
                o.x -= 7 + (curStage * 0.3);
                // ÿ±ÿ≥ŸÖ ÿßŸÑÿπŸÖŸàÿØ
                ctx.fillStyle = s.col; ctx.globalAlpha = 0.7;
                ctx.fillRect(o.x, 0, 60, o.y); 
                ctx.fillRect(o.x, o.y + o.h, 60, canvas.height);
                
                // ŸÉÿ™ÿßÿ®ÿ© ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿπŸÑŸâ ÿßŸÑÿπŸÖŸàÿØ
                ctx.globalAlpha = 1; ctx.fillStyle = "#fff"; ctx.font = "bold 14px Arial";
                ctx.save(); ctx.translate(o.x + 35, o.y - 20); ctx.rotate(-Math.PI/2);
                ctx.fillText(s.name, 0, 0); ctx.restore();

                if (p.x + 45 > o.x && p.x + 10 < o.x + 60 && (p.y < o.y || p.y + 45 > o.y + o.h)) die();
            });

            coins.forEach((c, i) => {
                c.x -= 7;
                ctx.font = "30px Arial"; ctx.fillText("üí∞", c.x, c.y);
                if (Math.hypot(p.x - c.x, p.y - c.y) < 50) { score += 50; coins.splice(i, 1); playSound('coin'); }
            });

            if (p.y > canvas.height || p.y < -50 || p.x < m.x + 70) die();
            document.getElementById('coinText').innerText = score;
        }

        // --- ÿ±ÿ≥ŸÖ ÿßŸÑŸàÿ≠ÿ¥ (ÿßŸÑÿßÿ™ÿ¨ÿßŸá ÿµÿ≠Ÿäÿ≠ ÿ™ŸÖÿßŸÖÿßŸã Ÿàÿ®ÿØŸàŸÜ ÿØŸàÿßÿ¶ÿ±) ---
        let monsterType = ['wolf', 'ghost', 'lion', 'dragon'][Math.floor(curStage/5) % 4];
        ctx.save();
        ctx.translate(m.x + 160, m.y); 
        ctx.scale(-1, 1); // ŸÇŸÑÿ® ÿßŸÑŸàÿ≠ÿ¥ ŸÑŸäŸÜÿ∏ÿ± ŸÑŸÑŸäŸÖŸäŸÜ (ÿ®ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÇÿ∑ÿ©)
        ctx.drawImage(imgObj[monsterType], 0, 0, 160, 160);
        ctx.restore();

        // ÿ±ÿ≥ŸÖ ÿßŸÑŸÇÿ∑ÿ©
        ctx.drawImage(imgObj.cat, p.x, p.y, 80, 80);

        requestAnimationFrame(gameLoop);
    }

    function die() {
        active = false; playSound('die');
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('mainMsg').innerText = "GAME OVER";
        document.getElementById('subMsg').innerText = "Score: " + score + " | City: " + STAGES[curStage].name;
    }

    function jump() { 
        if (active) { 
            if(!started) started = true;
            p.v = -9.5; playSound('jump'); 
        } 
    }
    
    window.onmousedown = jump; window.ontouchstart = (e) => { e.preventDefault(); jump(); };
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
    gameLoop();
</script>
</body>
</html>