<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: Infinite Nightmare</title>
    <style>
        :root { --neon: #00f2ff; --premium-bg: rgba(15, 15, 25, 0.85); }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, sans-serif; touch-action: none; color: white; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© UI Ø¹Ø§Ù„Ù…ÙŠØ© - Glassmorphism */
        #ui { 
            position: absolute; top: 20px; width: 100%; 
            display: flex; justify-content: space-around; z-index: 100; pointer-events: none; 
        }
        .stat-card { 
            background: var(--premium-bg); border: 1px solid var(--neon);
            backdrop-filter: blur(10px); padding: 10px 25px; border-radius: 50px;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2); font-weight: 900; font-size: 18px;
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨ØªØµÙ…ÙŠÙ… Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ */
        .screen {
            position: fixed; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000;
            background: radial-gradient(circle at center, #1a0033 0%, #000 100%);
            transition: 0.5s;
        }
        h1 { font-size: 3rem; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 30px var(--neon); margin-bottom: 10px; }
        
        .btn {
            padding: 18px 50px; font-size: 22px; background: linear-gradient(45deg, #00f2ff, #0062ff);
            border: none; border-radius: 50px; color: #fff; cursor: pointer; font-weight: bold;
            box-shadow: 0 10px 20px rgba(0, 242, 255, 0.4); transition: 0.3s; margin: 10px;
        }
        .btn:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 30px var(--neon); }
        .btn-shop { background: linear-gradient(45deg, #ffae00, #ff4500); box-shadow: 0 10px 20px rgba(255, 69, 0, 0.4); }

        /* Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„ÙØ§Ø®Ø± */
        #shop { display: none; }
        .shop-grid { display: flex; gap: 20px; margin: 30px; }
        .item { 
            background: rgba(255,255,255,0.05); padding: 25px; border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.1); width: 200px; text-align: center;
            transition: 0.3s;
        }
        .item:hover { background: rgba(255,255,255,0.1); border-color: var(--neon); }
        .price { color: #ffae00; font-size: 24px; font-weight: bold; display: block; margin: 15px 0; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-card">ğŸ’€ <span id="txt-lvl">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</span> <span id="lvlNum">1</span></div>
    <div class="stat-card">ğŸ’° <span id="coinText">0</span></div>
</div>

<div id="startScreen" class="screen">
    <h1 id="title">HIMALAYAN NIGHTMARE</h1>
    <p id="subtitle" style="color: #888; margin-bottom: 30px;">20 STAGES OF PURE HORROR</p>
    <button class="btn" onclick="startGame()">ENTER THE HELL</button>
    <button class="btn btn-shop" onclick="openShop()">UPGRADES (0.30$)</button>
</div>

<div id="shop" class="screen">
    <h1>ARMORY</h1>
    <div class="shop-grid">
        <div class="item">
            <h3>SUPER CAT</h3>
            <p>Higher Jump & Speed</p>
            <span class="price">0.30 $</span>
            <button class="btn" style="padding: 10px 20px; font-size: 14px;" onclick="buy('cat')">BUY NOW</button>
        </div>
        <div class="item">
            <h3>LASER GUN</h3>
            <p>Destroy Obstacles</p>
            <span class="price">0.30 $</span>
            <button class="btn" style="padding: 10px 20px; font-size: 14px;" onclick="buy('gun')">BUY NOW</button>
        </div>
    </div>
    <button class="btn" style="background: #333;" onclick="closeShop()">BACK</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    let audioCtx;

    // --- Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª (ØªÙ…Øª Ø¥Ø¹Ø§Ø¯ØªÙ‡ Ø¨Ù‚ÙˆØ©) ---
    function playSfx(type) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        if (type === 'jump') { osc.frequency.setValueAtTime(400, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); }
        else if (type === 'roar') { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(120, audioCtx.currentTime); shake = 15; gain.gain.setValueAtTime(0.3, audioCtx.currentTime); }
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    const assets = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        catSuper: 'https://img.icons8.com/color/96/cat-mask.png',
        wolf: 'https://img.icons8.com/color/150/werewolf.png',
        ghost: 'https://img.icons8.com/color/150/grim-reaper.png',
        lion: 'https://img.icons8.com/color/150/lion.png',
        dragon: 'https://img.icons8.com/color/150/dragon.png'
    };
    const imgObj = {}; Object.keys(assets).forEach(k => { imgObj[k] = new Image(); imgObj[k].src = assets[k]; });

    // Ù„ØºØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…
    const isAr = navigator.language.startsWith('ar');
    if (isAr) {
        document.getElementById('title').innerText = "ÙƒØ§Ø¨ÙˆØ³ Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§";
        document.getElementById('subtitle').innerText = "20 Ù…Ø±Ø­Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ø¹Ø¨ Ø§Ù„Ø®Ø§Ù„Øµ";
        document.querySelector('[onclick="startGame()"]').innerText = "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©";
        document.querySelector('[onclick="openShop()"]').innerText = "Ø§Ù„Ù…ØªØ¬Ø± (0.30$)";
        document.getElementById('txt-lvl').innerText = "Ø§Ù„Ù…Ø±Ø­Ù„Ø©";
    }

    let stages = Array.from({length: 20}, (_, i) => ({
        type: ['wolf', 'ghost', 'lion', 'dragon'][i % 4],
        color: ['#00f2ff', '#ff0055', '#ffae00', '#9d00ff'][i % 4],
        speed: 7 + (i * 0.4)
    }));

    let curLvl = 0, score = 0, active = false, started = false, shake = 0;
    let p = { x: 120, y: 0, v: 0, super: false, gun: false }, m = { x: -300, y: 0 };
    let obstacles = [], coins = [];

    function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        p.y = canvas.height / 2; p.v = 0; m.x = -300;
        obstacles = []; coins = []; active = true; started = false;
        document.getElementById('lvlNum').innerText = curLvl + 1;
    }

    function openShop() { document.getElementById('shop').style.display = 'flex'; }
    function closeShop() { document.getElementById('shop').style.display = 'none'; }
    function buy(item) { 
        alert(isAr ? "ØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ (0.30$)..." : "Redirecting to Payment (0.30$)..."); 
        if(item === 'cat') p.super = true; if(item === 'gun') p.gun = true;
        closeShop();
    }

    function gameLoop() {
        let s = stages[curLvl];
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Ø®Ù„ÙÙŠØ© Ø¶Ø¨Ø§Ø¨ÙŠØ©
        ctx.fillStyle = '#05050a'; ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (active && started) {
            p.v += 0.5; p.y += p.v; 
            m.y += (p.y - m.y) * 0.05; m.x = Math.min(p.x - 140, m.x + 0.35);

            // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 450) {
                if (Math.random() < 0.02) {
                    obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-350)+100, h: 280 });
                }
            }

            // Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² (Ù…ØªÙˆØ§Ø²Ù†Ø©)
            if (Math.random() < 0.01) coins.push({ x: canvas.width, y: Math.random()*canvas.height });

            obstacles.forEach((o, i) => {
                o.x -= s.speed;
                ctx.fillStyle = s.color; ctx.globalAlpha = 0.4; // Ø¥Ø¶Ø§Ø¡Ø© Ù‡Ø§Ø¯Ø¦Ø©
                ctx.fillRect(o.x, 0, 40, o.y); ctx.fillRect(o.x, o.y + o.h, 40, canvas.height);
                ctx.globalAlpha = 1;
                
                // Ø³Ù„Ø§Ø­ Ø§Ù„Ù„ÙŠØ²Ø±
                if (p.gun && Math.abs(p.x - o.x) < 150) {
                    ctx.strokeStyle = '#00f2ff'; ctx.lineWidth = 5;
                    ctx.beginPath(); ctx.moveTo(p.x+50, p.y+30); ctx.lineTo(o.x, o.y + o.h/2); ctx.stroke();
                    obstacles.splice(i, 1);
                }

                if (p.x + 40 > o.x && p.x < o.x + 40 && (p.y < o.y || p.y + 40 > o.y + o.h)) die();
            });

            coins.forEach((c, i) => {
                c.x -= s.speed;
                ctx.font = "24px Arial"; ctx.fillText("ğŸ’°", c.x, c.y);
                if (Math.hypot(p.x - c.x, p.y - c.y) < 40) { score += 5; coins.splice(i, 1); }
            });

            if (p.y > canvas.height || p.x < m.x + 60) die();
            document.getElementById('coinText').innerText = score;
        }

        // --- Ø±Ø³Ù… Ø§Ù„ÙˆØ­Ø´ (Ø´Ø¨Ù‡ 3DØŒ ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ù‚Ø·Ø©ØŒ Ø¨Ø¯ÙˆÙ† Ø¯Ø§Ø¦Ø±Ø©) ---
        let breath = Math.sin(Date.now() / 200) * 8;
        ctx.save();
        ctx.translate(m.x + 150, m.y + breath);
        ctx.scale(-1, 1); // ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ù‚Ø·Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹
        ctx.shadowBlur = 20; ctx.shadowColor = s.color;
        ctx.drawImage(imgObj[s.type], 0, 0, 160 + breath, 160 - breath);
        ctx.restore();

        // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø©
        ctx.drawImage(p.super ? imgObj.catSuper : imgObj.cat, p.x, p.y, 75, 75);

        requestAnimationFrame(gameLoop);
    }

    function die() { 
        active = false; playSfx('roar'); 
        document.getElementById('startScreen').style.display = 'flex';
        document.getElementById('title').innerText = isAr ? "Ø³Ø­Ù‚ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´!" : "YOU DIED!";
    }

    const jump = () => { if (active) { started = true; p.v = p.super ? -11 : -9; playSfx('jump'); } }
    window.onmousedown = jump; window.ontouchstart = jump;
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
    gameLoop();
</script>
</body>
</html>