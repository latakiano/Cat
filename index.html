<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: The 20 Stages</title>
    <style>
        :root { --gold: #FFD700; --cyan: #00F2FF; }
        body { margin: 0; background: #010105; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
        #hud { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; }
        .card { background: rgba(255,255,255,0.1); padding: 8px 20px; border-radius: 20px; border: 1px solid var(--gold); font-weight: bold; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ù„Ù…Ø³Ø§ÙØ©) */
        #dist-ui { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 70%; text-align: center; }
        #bar-bg { width: 100%; height: 8px; background: #222; border-radius: 10px; margin-top: 5px; border: 1px solid var(--cyan); overflow: hidden; }
        #bar-fill { width: 0%; height: 100%; background: var(--cyan); box-shadow: 0 0 15px var(--cyan); }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ© */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        .win-box { background: #1a1a2e; padding: 40px; border-radius: 30px; border: 4px solid var(--gold); box-shadow: 0 0 50px var(--gold); }
        .btn { padding: 15px 60px; font-size: 22px; background: var(--gold); border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; color: #000; }
    </style>
</head>
<body>

<div id="hud">
    <div class="card">ğŸ’° Ø§Ù„Ø°Ù‡Ø¨: <span id="g-val">0</span></div>
    <div class="card">ğŸ† Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <span id="s-val">1</span></div>
</div>

<div id="dist-ui">
    <div style="font-size: 14px; color: var(--cyan);">Ø§Ù„Ù…Ø³Ø§ÙØ© Ù†Ø­Ùˆ Ø§Ù„ÙƒÙ‡Ù: <span id="p-val">0%</span></div>
    <div id="bar-bg"><div id="bar-fill"></div></div>
</div>

<div id="screen" class="overlay">
    <div id="win-content" class="win-box">
        <h1 id="msg-title" style="color: var(--gold);">Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§</h1>
        <p id="msg-body">Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø·Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙ‡Ù</p>
        <button class="btn" id="main-btn" onclick="startLevel()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1</button>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const cvs = document.getElementById('game'), ctx = cvs.getContext('2d');
let active = false, frame = 0, stage = 1, gold = 0, dist = 0;
let targetDist = 4000; // Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ²ÙŠØ¯ Ù…Ø¹ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©

let player = { x: 120, y: 0, v: 0, g: 0.45, j: -9 };
let wolf = { x: -200, y: 0 };
let obs = [], coins = [], stars = [];
let cave = { x: -500, active: false };

// ØµÙˆØª Ø§Ù„Ù‚ÙØ²Ø© ÙˆØ§Ù„ÙƒÙˆÙŠÙ†Ø²
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSfx(f, t, d) {
    const o = audio.createOscillator(), g = audio.createGain();
    o.type = t; o.connect(g); g.connect(audio.destination);
    o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.setValueAtTime(0.1, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + d);
    o.start(); o.stop(audio.currentTime + d);
}

function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
window.onresize = resize; resize();
for(let i=0; i<60; i++) stars.push({x: Math.random()*cvs.width, y: Math.random()*cvs.height, s: Math.random()*2});

function startLevel() {
    document.getElementById('screen').style.display = 'none';
    player.y = cvs.height/2;
    dist = 0; obs = []; coins = []; cave.active = false;
    targetDist = 3000 + (stage * 1000); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
    active = true;
    if(frame === 0) loop(); 
}

window.onmousedown = () => { if(active) { player.v = player.j; playSfx(300, 'square', 0.2); } };
window.ontouchstart = (e) => { if(active) { player.v = player.j; playSfx(300, 'square', 0.2); } e.preventDefault(); };

function drawCat(x, y) {
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = "#FDF5E6"; ctx.beginPath(); ctx.ellipse(0, 0, 28, 18, 0, 0, 7); ctx.fill();
    ctx.fillStyle = "#3E2723"; ctx.beginPath(); ctx.moveTo(15,-15); ctx.lineTo(20,-30); ctx.lineTo(25,-15); ctx.fill();
    ctx.beginPath(); ctx.arc(25, -8, 10, 0, 7); ctx.fill();
    ctx.fillStyle = "#00E5FF"; ctx.beginPath(); ctx.arc(28, -10, 3, 0, 7); ctx.fill();
    ctx.restore();
}

function drawCave(x, y) {
    ctx.fillStyle = "#444"; // ØµØ®ÙˆØ± Ø§Ù„ÙƒÙ‡Ù
    ctx.beginPath(); ctx.moveTo(x, y+100); ctx.lineTo(x+50, y-120); ctx.lineTo(x+150, y-120); ctx.lineTo(x+200, y+100); ctx.fill();
    ctx.fillStyle = "#000"; // ÙØªØ­Ø© Ø§Ù„ÙƒÙ‡Ù
    ctx.beginPath(); ctx.ellipse(x+100, y+20, 40, 60, 0, 0, 7); ctx.fill();
    ctx.fillStyle = var(--gold); ctx.font = "bold 20px Arial"; ctx.fillText("Ø§Ù„ÙƒÙ‡Ù", x+75, y-80);
}

function loop() {
    if(!active) return;
    frame++;
    ctx.fillStyle = "#020208"; ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Ø§Ù„Ù†Ø¬ÙˆÙ…
    ctx.fillStyle = "#fff";
    stars.forEach(s => { s.x -= 0.5; if(s.x < 0) s.x = cvs.width; ctx.fillRect(s.x, s.y, s.s, s.s); });

    player.v += player.g; player.y += player.v;
    dist += (5 + stage*0.2);
    let prog = Math.min(100, (dist/targetDist)*100);
    document.getElementById('bar-fill').style.width = prog + "%";
    document.getElementById('p-val').innerText = Math.floor(prog) + "%";

    drawCat(player.x, player.y);
    wolf.x = player.x - 160 + Math.sin(frame*0.05)*20;
    wolf.y += (player.y - wolf.y) * 0.05;
    ctx.font = "60px Arial"; ctx.fillText("ğŸº", wolf.x, wolf.y + 20);

    // ÙƒÙˆÙŠÙ†Ø²
    if(frame % 80 == 0 && !cave.active) coins.push({x: cvs.width, y: Math.random()*cvs.height});
    coins.forEach((c, i) => {
        c.x -= 6; ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(c.x, c.y, 10, 0, 7); ctx.fill();
        if(Math.hypot(player.x-c.x, player.y-c.y) < 40) { coins.splice(i,1); gold+=10; playSfx(1000, 'sine', 0.1); document.getElementById('g-val').innerText = gold; }
    });

    // Ø§Ù„Ø­ÙˆØ§Ø¬Ø² (ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ù…Ø³Ø§ÙØ© Ø§Ù†Ø·Ù„Ø§Ù‚ 500)
    if(frame % 100 == 0 && dist > 500 && dist < targetDist - 800) {
        let h = Math.random()*(cvs.height-300)+50;
        obs.push({x: cvs.width, y: 0, h: h, c: `hsl(${(stage*50)%360}, 70%, 50%)`});
        obs.push({x: cvs.width, y: h+250, h: cvs.height, c: `hsl(${(stage*50)%360}, 70%, 50%)`});
    }
    obs.forEach((o, i) => {
        o.x -= (6 + stage*0.5);
        ctx.fillStyle = o.c; ctx.fillRect(o.x, o.y, 60, o.h);
        if(player.x+20 > o.x && player.x-20 < o.x+60 && player.y+15 > o.y && player.y-15 < o.y+o.h) die();
    });

    // Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒÙ‡Ù
    if(dist >= targetDist && !cave.active) { cave.active = true; cave.x = cvs.width; }
    if(cave.active) {
        cave.x -= 5;
        drawCave(cave.x, player.y);
        if(player.x > cave.x + 100) winLevel();
    }

    if(player.y > cvs.height || player.y < 0) die();
    requestAnimationFrame(loop);
}

function winLevel() {
    active = false;
    playSfx(600, 'sine', 0.5);
    document.getElementById('screen').style.display = 'flex';
    document.getElementById('msg-title').innerText = "ØªÙ… Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„Ù…Ø±Ø­Ù„Ø© " + stage;
    document.getElementById('msg-body').innerText = "Ø±Ø§Ø¦Ø¹! Ø§Ù„Ù‚Ø·Ø© ÙÙŠ Ø£Ù…Ø§Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ‡Ù. Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.";
    stage++;
    document.getElementById('s-val').innerText = stage;
    document.getElementById('main-btn').innerText = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø­Ù„Ø© " + stage;
}

function die() { alert("Ø£Ù…Ø³Ùƒ Ø¨Ùƒ Ø§Ù„Ø°Ø¦Ø¨! Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹."); location.reload(); }
</script>
</body>
</html>