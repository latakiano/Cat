<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: Dungeon Legends Pro</title>
    <style>
        :root { --neon: #ffd700; --accent: #00f2ff; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, sans-serif; touch-action: none; color: white; }
        
        /* HUD - Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ */
        #ui { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat-card { 
            background: rgba(0, 0, 0, 0.8); border: 2px solid var(--neon);
            backdrop-filter: blur(10px); padding: 10px 18px; border-radius: 20px; 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); font-weight: bold; font-size: 18px;
        }

        /* ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ */
        .overlay { 
            position: fixed; inset: 0; background: radial-gradient(circle, #1a0033 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; text-align: center; padding: 20px;
        }
        
        .btn {
            padding: 16px 50px; font-size: 22px; background: linear-gradient(45deg, #ffd700, #ff8c00);
            border: none; border-radius: 50px; color: #000; cursor: pointer; font-weight: bold;
            box-shadow: 0 8px 15px rgba(255, 215, 0, 0.3); transition: 0.3s; margin: 10px;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 25px var(--neon); }
        .btn-shop { background: linear-gradient(45deg, var(--accent), #0062ff); color: white; }

        #highScoreText { color: var(--accent); font-size: 24px; margin: 10px 0; font-weight: 900; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-card">üè∞ <span id="stageTitle">Loading...</span></div>
    <div class="stat-card">üí∞ <span id="coinScore">0</span></div>
    <div class="stat-card" style="border-color: var(--accent);">üèÜ <span id="bestScore">0</span></div>
</div>

<div id="startScreen" class="overlay">
    <h1 id="mainTitle" style="font-size: 3.5rem; text-shadow: 0 0 20px var(--neon); margin-bottom: 5px;">HIMALAYAN LEGENDS</h1>
    <div id="highScoreText">BEST: 0</div>
    <button class="btn" onclick="startGame()" id="playBtn">START MISSION</button>
    <button class="btn btn-shop" onclick="alert('30 Cents - Secure Gateway Loading...')" id="shopBtn">SHOP (0.30$)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    let audioCtx;

    // --- ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸàÿßŸÑŸÑÿ∫ÿßÿ™ ---
    const isAr = navigator.language.startsWith('ar');
    const lang = {
        ar: { start: "ÿ®ÿØÿ° ÿßŸÑŸÖŸáŸÖÿ©", shop: "ÿßŸÑŸÖÿ™ÿ¨ÿ± (0.30$)", best: "ÿ£ŸÅÿ∂ŸÑ ŸÜÿ™Ÿäÿ¨ÿ©: ", dungeon: "ÿØŸáŸÑŸäÿ≤", death: "ÿ≥ÿ≠ŸÇÿ™ŸÉ ÿßŸÑŸàÿ≠Ÿàÿ¥!", retry: "ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©" },
        en: { start: "START MISSION", shop: "SHOP (0.30$)", best: "BEST SCORE: ", dungeon: "Dungeon of", death: "YOU DIED!", retry: "RETRY" }
    }[isAr ? 'ar' : 'en'];

    // --- ŸÜÿ∏ÿßŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÉŸàÿ± ---
    let highScore = localStorage.getItem('himalayanBest') || 0;
    document.getElementById('bestScore').innerText = highScore;
    document.getElementById('highScoreText').innerText = lang.best + highScore;

    // --- ŸÖÿ≠ÿ±ŸÉ ÿßŸÑÿµŸàÿ™ ---
    function playSfx(freq, type = 'sine') {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    // --- ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ ÿßŸÑŸÄ 20 ---
    const cities = ["London", "New York", "Paris", "Berlin", "Amsterdam", "Beijing", "Rome", "Moscow", "Athens", "Bucharest", "Tokyo", "Dubai", "Cairo", "Madrid", "Sydney", "Rio", "Seoul", "Istanbul", "Prague", "Latakia"];
    const colors = ["#FFFF00", "#0000FF", "#FF0000", "#00FF00", "#FFFFFF", "#00FFFF", "#8B4513", "#800000", "#800080", "#000080", "#FF4500", "#FFD700", "#C0C0C0", "#32CD32", "#1E90FF", "#FF69B4", "#00CED1", "#A52A2A", "#556B2F", "#00f2ff"];
    
    const STAGES = cities.map((city, i) => ({
        name: `${isAr ? 'ÿØŸáŸÑŸäÿ≤' : 'Dungeon of'} ${city}`,
        col: colors[i],
        monster: i === 19 ? 'lion' : ['wolf', 'ghost', 'dragon'][i % 3],
        speed: 6.5 + (i * 0.45)
    }));

    const assets = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        coin: 'https://img.icons8.com/color/48/gold-pot.png',
        wolf: 'https://img.icons8.com/fluency/150/werewolf.png',
        ghost: 'https://img.icons8.com/fluency/150/ghost.png',
        dragon: 'https://img.icons8.com/fluency/150/dragon.png',
        lion: 'https://img.icons8.com/fluency/150/lion.png'
    };
    const img = {}; Object.keys(assets).forEach(k => { img[k] = new Image(); img[k].src = assets[k]; });

    let cur = 0, score = 0, active = false, started = false;
    let p = { x: 130, y: 0, v: 0 }, m = { x: -300, y: 0 };
    let obstacles = [], coins = [], stageDist = 2200;

    function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        p.y = canvas.height / 2; p.v = 0; m.x = -300;
        obstacles = []; coins = []; stageDist = 2200; active = true; started = false; score = 0;
        document.getElementById('stageTitle').innerText = STAGES[cur].name;
    }

    function gameLoop() {
        let s = STAGES[cur];
        ctx.fillStyle = "#050508"; ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (active && started) {
            p.v += 0.52; p.y += p.v; 
            m.y += (p.y - m.y) * 0.05; m.x = Math.min(p.x - 150, m.x + 0.35);
            stageDist -= s.speed/2;

            if (stageDist <= 0 && cur < 19) { 
                cur++; stageDist = 2200; 
                document.getElementById('stageTitle').innerText = STAGES[cur].name;
            }

            // ÿßŸÑÿ£ÿπŸÖÿØÿ©
            if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 550) {
                obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-400)+100, h: 280 });
            }

            // ÿßŸÑÿ¨Ÿàÿßÿ¶ÿ≤ (ŸÖÿ™Ÿàÿßÿ≤ŸÜÿ©)
            if (Math.random() < 0.01) coins.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50 });

            obstacles.forEach((o, i) => {
                o.x -= s.speed;
                ctx.fillStyle = s.col; ctx.globalAlpha = 0.5;
                ctx.fillRect(o.x, 0, 55, o.y); ctx.fillRect(o.x, o.y+o.h, 55, canvas.height);
                ctx.globalAlpha = 1; ctx.fillStyle = "white"; ctx.font = "bold 12px sans-serif";
                ctx.fillText(cities[cur].toUpperCase(), o.x + 5, o.y - 10);

                if (p.x + 40 > o.x && p.x < o.x + 55 && (p.y < o.y || p.y + 45 > o.y + o.h)) die();
            });

            coins.forEach((c, i) => {
                c.x -= s.speed;
                ctx.drawImage(img.coin, c.x, c.y, 40, 40);
                if (Math.hypot(p.x - c.x, p.y - c.y) < 50) { 
                    score += 10; coins.splice(i, 1); playSfx(880); 
                }
            });

            if (p.y > canvas.height || p.x < m.x + 80) die();
            document.getElementById('coinScore').innerText = score;
        }

        // --- ÿ±ÿ≥ŸÖ ÿßŸÑŸàÿ≠ÿ¥ (ŸäŸàÿßÿ¨Ÿá ÿßŸÑŸÇÿ∑ÿ©ÿå ÿ®ÿØŸàŸÜ ÿØŸàÿßÿ¶ÿ±) ---
        let breath = Math.sin(Date.now() / 200) * 10;
        ctx.save();
        ctx.translate(m.x + 160, m.y + breath); 
        ctx.scale(-1, 1); // ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÑŸÑŸÇÿ∑ÿ©
        ctx.drawImage(img[s.monster], 0, 0, 160 + breath, 160 - breath);
        ctx.restore();

        // ÿ±ÿ≥ŸÖ ÿßŸÑŸÇÿ∑ÿ©
        ctx.drawImage(img.cat, p.x, p.y, 85, 85);

        requestAnimationFrame(gameLoop);
    }

    function die() {
        active = false; playSfx(150, 'sawtooth');
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('himalayanBest', highScore);
            document.getElementById('bestScore').innerText = highScore;
        }
        document.getElementById('startScreen').style.display = 'flex';
        document.getElementById('mainTitle').innerText = lang.death;
        document.getElementById('highScoreText').innerText = lang.best + highScore;
        document.getElementById('playBtn').innerText = lang.retry;
    }

    const jump = () => { if (active) { started = true; p.v = -9.5; playSfx(450); } }
    window.onmousedown = jump; window.ontouchstart = (e) => { e.preventDefault(); jump(); };
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize();
    gameLoop();
</script>
</body>
</html>