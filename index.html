<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat: Mario Soul Edition</title>
    <style>
        :root { --gold: #FFD700; --neon: #00F2FF; --danger: #FF3D00; }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Download Style Distance) */
        #distance-ui {
            position: fixed; top: 20px; right: 20px; width: 200px; 
            background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 1px solid var(--neon);
        }
        #dl-bar { width: 100%; height: 6px; background: #333; margin-top: 5px; border-radius: 5px; overflow: hidden; }
        #dl-fill { width: 0%; height: 100%; background: var(--neon); box-shadow: 0 0 10px var(--neon); }

        /* HUD */
        #hud { position: fixed; top: 20px; left: 20px; display: flex; gap: 15px; z-index: 100; }
        .stat-card { background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 15px; border-bottom: 3px solid var(--gold); font-weight: bold; }

        /* Ø§Ù„Ù…ØªØ§Ø¬Ø± ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .window { background: #1a1a2e; width: 90%; max-width: 500px; border-radius: 25px; border: 4px solid var(--gold); padding: 30px; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .shop-item { background: #252545; padding: 15px; border-radius: 15px; border: 1px solid #444; }
        .buy-btn { background: var(--gold); border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        #shop-trigger { position: fixed; bottom: 20px; left: 20px; background: var(--gold); color: #000; padding: 15px; border-radius: 50%; font-weight: bold; cursor: pointer; border: 4px solid #fff; }
    </style>
</head>
<body>

<div id="distance-ui">
    <div style="font-size: 12px; display: flex; justify-content: space-between;">
        <span>Progressing...</span><span id="dist-percent">0%</span>
    </div>
    <div id="dl-bar"><div id="dl-fill"></div></div>
</div>

<div id="hud">
    <div class="stat-card">ğŸŸ¡ <span id="gld-val">0</span></div>
    <div class="stat-card">ğŸ† STAGE: <span id="lvl-val">1</span></div>
</div>

<div id="shop-trigger" onclick="showShop()">SHOP</div>

<div id="start-screen" class="overlay">
    <div class="window">
        <h1 style="font-size: 2.5rem; color: var(--gold);">Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§</h1>
        <p>Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø§Ù„Ø°Ø¦Ø¨ ÙˆØ¬Ù…Ø¹ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²!</p>
        <button class="buy-btn" style="font-size: 24px; padding: 15px;" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</button>
    </div>
</div>

<div id="shop-screen" class="overlay" style="display:none">
    <div class="window">
        <h2>Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ ğŸ›’</h2>
        <div class="grid">
            <div class="shop-item"><div>ğŸˆâ€â¬› Ø§Ù„Ù‚Ø·Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡</div><button class="buy-btn" onclick="buy(1, 100)">100 ğŸŸ¡</button></div>
            <div class="shop-item"><div>ğŸ¦ Ø§Ù„Ø£Ø³Ø¯ Ø§Ù„Ù…Ù„Ùƒ</div><button class="buy-btn" onclick="buy(2, 500)">500 ğŸŸ¡</button></div>
            <div class="shop-item"><div>âš¡ Ø³Ø±Ø¹Ø© ÙØ§Ø¦Ù‚Ø©</div><button class="buy-btn" onclick="buyEffect('speed', 200)">200 ğŸŸ¡</button></div>
            <div class="shop-item"><div>ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø­Ù…Ø§ÙŠØ©</div><button class="buy-btn" onclick="buyEffect('shield', 300)">300 ğŸŸ¡</button></div>
        </div>
        <button class="buy-btn" style="background: #666; color: #fff; margin-top: 20px;" onclick="hideShop()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let active = false, stage = 1, gold = 0, distance = 0, targetDistance = 5000;
let frame = 0, playerType = 0;

// Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø¯Ù…Ø¬ (Ø¨Ø¯ÙˆÙ† Ù…Ù„ÙØ§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ù…Ù„)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, type, duration) {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = type; osc.connect(g); g.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.start(); osc.stop(audioCtx.currentTime + duration);
}

const jumpSound = () => { playSound(200, 'square', 0.2); playSound(400, 'square', 0.3); }; // ØµÙˆØª Ù…Ø§Ø±ÙŠÙˆ
const coinSound = () => { playSound(800, 'sine', 0.1); setTimeout(()=>playSound(1200, 'sine', 0.2), 50); }; // Ø±Ù†Ø© Ø§Ù„ÙƒÙˆÙŠÙ†Ø²

// Ø§Ù„ØµÙˆØ±
const catImg = new Image(); catImg.src = 'https://img.icons8.com/emoji/96/cat-face.png';
const wolfImg = new Image(); wolfImg.src = 'https://img.icons8.com/color/96/wolf.png';

let p = { x: 120, y: 0, v: 0, g: 0.5, j: -10, w: 60, h: 60 };
let wolf = { x: -200, y: 0 };
let coins = [], obs = [];

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onresize = resize; resize();

function startGame() { document.getElementById('start-screen').style.display = 'none'; active = true; p.y = 300; animate(); }
function showShop() { document.getElementById('shop-screen').style.display = 'flex'; active = false; }
function hideShop() { document.getElementById('shop-screen').style.display = 'none'; active = true; animate(); }

function buy(t, price) { if(gold >= price) { gold -= price; playerType = t; updateHUD(); alert("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø·Ø©!"); } else alert("Ø§Ù„Ø°Ù‡Ø¨ ØºÙŠØ± ÙƒØ§ÙÙ!"); }

window.onmousedown = () => { if(active) { p.v = p.j; jumpSound(); } };

function animate() {
    if(!active) return;
    frame++;
    ctx.fillStyle = "#050510"; ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ÙÙŠØ²ÙŠØ§Ø¡ ÙˆÙ…Ø³Ø§ÙØ©
    p.v += p.g; p.y += p.v;
    distance += 5;
    let prog = (distance / targetDistance) * 100;
    document.getElementById('dl-fill').style.width = prog + "%";
    document.getElementById('dist-percent').innerText = Math.floor(prog) + "%";

    // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø© ÙˆØ§Ù„Ø°Ø¦Ø¨ (ÙˆØ¬Ù‡ Ù„Ù„Ø£Ù…Ø§Ù…)
    ctx.drawImage(catImg, p.x, p.y, p.w, p.h);
    wolf.x = p.x - 180 + Math.sin(frame*0.05)*30;
    wolf.y += (p.y - wolf.y) * 0.05;
    ctx.drawImage(wolfImg, wolf.x, wolf.y, 80, 80);

    // Ø§Ù„ÙƒÙˆÙŠÙ†Ø² (ğŸŸ¡)
    if(frame % 50 == 0) coins.push({x: canvas.width, y: Math.random()*canvas.height, s: 5});
    coins.forEach((c, i) => {
        c.x -= c.s;
        ctx.fillStyle = var(--gold); ctx.font = "25px Arial"; ctx.fillText("ğŸŸ¡", c.x, c.y);
        if(Math.hypot(p.x - c.x, p.y - c.y) < 40) { coins.splice(i,1); gold += 10; coinSound(); updateHUD(); }
    });

    // Ø­ÙˆØ§Ø¬Ø² Ù…ØªÙ„ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    if(frame % 100 == 0) {
        let h = Math.random()*(canvas.height-300)+50;
        obs.push({x: canvas.width, y: 0, h: h, color: `hsl(${stage * 40}, 70%, 50%)`});
        obs.push({x: canvas.width, y: h+250, h: canvas.height, color: `hsl(${stage * 40}, 70%, 50%)`});
    }

    obs.forEach((o, i) => {
        o.x -= (5 + stage);
        ctx.fillStyle = o.color; ctx.shadowBlur = 15; ctx.shadowColor = o.color;
        ctx.fillRect(o.x, o.y, 50, o.h); ctx.shadowBlur = 0;
        if(p.x < o.x + 50 && p.x + 40 > o.x && p.y < o.y + o.h && p.y + 40 > o.y) die();
    });

    if(distance >= targetDistance) nextLevel();
    if(p.y > canvas.height || p.y < 0) die();

    requestAnimationFrame(animate);
}

function updateHUD() {
    document.getElementById('gld-val').innerText = gold;
    document.getElementById('lvl-val').innerText = stage;
}

function nextLevel() {
    active = false; stage++; distance = 0; targetDistance += 2000;
    alert("ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù…Ø±Ø­Ù„Ø©. ØªØ±ØªÙŠØ¨Ùƒ ÙŠØªØ­Ø³Ù†!");
    updateHUD(); active = true; animate();
}

function die() { alert("Ø£Ù…Ø³Ùƒ Ø¨Ùƒ Ø§Ù„Ø°Ø¦Ø¨!"); location.reload(); }
</script>
</body>
</html>